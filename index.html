<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course de Voilier</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #4f9cf9, #2563eb);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2563eb;
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .btn-green { background: #10b981; }
        .btn-green:hover { background: #059669; }
        
        .btn-yellow { background: #f59e0b; }
        .btn-yellow:hover { background: #d97706; }
        
        .btn-red { background: #ef4444; }
        .btn-red:hover { background: #dc2626; }
        
        .btn-purple { background: #8b5cf6; }
        .btn-purple:hover { background: #7c3aed; }
        
        .btn-orange { background: #f97316; }
        .btn-orange:hover { background: #ea580c; }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-5 { grid-template-columns: repeat(5, 1fr); }
        
        .text-center { text-align: center; }
        .text-white { color: white; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: bold; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mt-4 { margin-top: 16px; }
        .p-4 { padding: 16px; }
        .hidden { display: none; }
        
        .stat-card {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .stat-green {
            background: #ecfdf5;
            border-color: #10b981;
            color: #065f46;
        }
        
        .stat-yellow {
            background: #fefbeb;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        .stat-purple {
            background: #f5f3ff;
            border-color: #8b5cf6;
            color: #581c87;
        }
        
        .race-track {
            background: linear-gradient(90deg, #bfdbfe 0%, #3b82f6 100%);
            height: 100px;
            border-radius: 8px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .boat {
            position: absolute;
            font-size: 24px;
            transition: all 1s ease;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .boat-player {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(-50%); }
            40% { transform: translateY(-60%); }
            60% { transform: translateY(-55%); }
        }
        
        .finish-line {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #dc2626;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #d1d5db;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        
        .optimum { color: #10b981; font-weight: bold; }
        .not-optimum { color: #ef4444; font-weight: bold; }
        
        .championship-info {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        .upgrade-item {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sponsor-item {
            background: #fdf4ff;
            border: 1px solid #c084fc;
            border-radius: 8px;
            padding: 16px;
            margin: 8px 0;
        }
        
        .race-status {
            background: #10b981;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Principal -->
        <div id="menu" class="screen">
            <h1 class="text-3xl font-bold text-white text-center mb-6">üèÅ Course de Voilier üèÅ</h1>
            
            <!-- Statut de course en cours -->
            <div id="race-status" class="race-status hidden">
                <div class="text-center">
                    <strong>Course en cours !</strong><br>
                    Position: <span id="current-position">1</span>/8 - 
                    Temps restant: <span id="time-remaining">0</span>
                    <button class="btn btn-green" onclick="showScreen('race')">Retour √† la course</button>
                </div>
            </div>
            
            <!-- Stats du joueur -->
            <div class="card">
                <div class="grid grid-3">
                    <div class="stat-card stat-green">
                        <div class="font-bold">Argent</div>
                        <div class="text-2xl" id="player-money">25,000‚Ç¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="font-bold">XP</div>
                        <div class="text-2xl" id="player-xp">0</div>
                    </div>
                    <div class="stat-card stat-purple">
                        <div class="font-bold">Niveau</div>
                        <div class="text-2xl" id="player-level">1</div>
                    </div>
                </div>
            </div>
            
            <!-- Menu principal -->
            <div class="card">
                <div class="grid grid-5">
                    <button class="btn btn-green" onclick="showScreen('race-setup')">
                        üèÅ<br>Course Libre
                    </button>
                    <button class="btn btn-yellow" onclick="showScreen('championships')">
                        üèÜ<br>Championnats
                    </button>
                    <button class="btn btn-orange" onclick="showScreen('shop')">
                        üõí<br>Boutique
                    </button>
                    <button class="btn btn-purple" onclick="showScreen('sponsors')">
                        ü§ù<br>Sponsors
                    </button>
                    <button class="btn" onclick="showScreen('history')">
                        üìä<br>Historique
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Configuration de course -->
        <div id="race-setup" class="screen hidden">
            <button class="btn" onclick="showScreen('menu')">‚Üê Retour</button>
            <div class="card">
                <h2 class="text-2xl font-bold text-center mb-4">Configuration de Course</h2>
                
                <div class="mb-6">
                    <h3 class="font-bold mb-4">Difficult√© des adversaires</h3>
                    <div class="grid grid-3">
                        <button class="btn" id="diff-debutant" onclick="setDifficulty('debutant')">D√©butant</button>
                        <button class="btn" id="diff-intermediaire" onclick="setDifficulty('intermediaire')">Interm√©diaire</button>
                        <button class="btn" id="diff-expert" onclick="setDifficulty('expert')">Expert</button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-bold mb-4">Dur√©e de la course: <span id="duration-display">5 minutes</span></h3>
                    <input type="range" id="duration-slider" class="slider" min="1" max="10080" value="5" onchange="updateDuration()">
                    <div class="grid grid-5 text-center text-sm mt-2">
                        <span>1 min</span>
                        <span>1 heure</span>
                        <span>12 heures</span>
                        <span>3 jours</span>
                        <span>7 jours</span>
                    </div>
                </div>
                
                <button class="btn btn-green text-xl" style="width: 100%; padding: 16px;" onclick="startRace()" id="start-race-btn">
                    Commencer la Course
                </button>
            </div>
        </div>
        
        <!-- √âcran de course -->
        <div id="race" class="screen hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <button class="btn" onclick="showScreen('menu')">‚Üê Menu</button>
                <h2 class="text-2xl font-bold text-white">Course en Direct</h2>
                <div style="width: 80px;"></div>
            </div>
            
            <div class="card">
                <!-- Stats de course -->
                <div class="grid grid-4 mb-6">
                    <div class="stat-card">
                        <div class="font-bold">Position</div>
                        <div class="text-2xl" id="race-position">1/8</div>
                    </div>
                    <div class="stat-card stat-green">
                        <div class="font-bold">Temps Restant</div>
                        <div class="text-xl" id="race-time">5:00</div>
                    </div>
                    <div class="stat-card stat-yellow">
                        <div class="font-bold">M√©t√©o</div>
                        <div id="weather">üåä Normal</div>
                    </div>
                    <div class="stat-card stat-purple">
                        <div class="font-bold">Progr√®s</div>
                        <div class="text-xl" id="race-progress">0%</div>
                    </div>
                </div>
                
                <!-- Info championnat -->
                <div id="championship-info" class="championship-info hidden">
                    <strong>Championnat en cours</strong> - Course <span id="champ-race-num">1</span>/20 - 
                    Points: <span id="champ-points">0</span>
                </div>
                
                <!-- Contr√¥le des voiles -->
                <div class="mb-6">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span class="font-bold">R√©glage des Voiles: <span id="sail-value">50</span>%</span>
                        <span id="sail-status" class="optimum">OPTIMUM</span>
                    </div>
                    <input type="range" id="sail-slider" class="slider" min="0" max="100" value="50" 
                           onchange="updateSails()" disabled>
                </div>
                
                <!-- Pilote automatique -->
                <div class="mb-6">
                    <button class="btn btn-green" id="autopilot-btn" onclick="toggleAutopilot()">
                        ü§ñ Pilote Auto: ON
                    </button>
                    <span id="autopilot-efficiency" class="ml-4">Efficacit√©: 80%</span>
                </div>
                
                <!-- Visualisation de la course -->
                <div class="race-track" id="race-track">
                    <div class="finish-line"></div>
                    <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); 
                                color: white; font-weight: bold; font-size: 12px;">ARRIV√âE</div>
                    
                    <!-- Les bateaux seront ajout√©s dynamiquement ici -->
                </div>
                
                <!-- Classement -->
                <div>
                    <h3 class="font-bold mb-4">Classement en Direct</h3>
                    <div id="race-ranking"></div>
                </div>
            </div>
        </div>
        
        <!-- Championnats -->
        <div id="championships" class="screen hidden">
            <button class="btn" onclick="showScreen('menu')">‚Üê Retour</button>
            <div class="card">
                <h2 class="text-2xl font-bold text-center mb-4">üèÜ Championnats</h2>
                
                <!-- Championnat en cours -->
                <div id="active-championship" class="championship-info hidden">
                    <h3 class="font-bold">Championnat en cours: <span id="active-champ-name"></span></h3>
                    <div class="grid grid-3 mt-4">
                        <div class="text-center">
                            <div class="font-bold">Course</div>
                            <div class="text-xl" id="champ-current-race">1/20</div>
                        </div>
                        <div class="text-center">
                            <div class="font-bold">Vos Points</div>
                            <div class="text-xl" id="champ-your-points">0</div>
                        </div>
                        <div class="text-center">
                            <div class="font-bold">Position</div>
                            <div class="text-xl" id="champ-your-position">1er</div>
                        </div>
                    </div>
                </div>
                
                <!-- Liste des championnats -->
                <div id="championships-list">
                    <!-- Les championnats seront ajout√©s dynamiquement -->
                </div>
            </div>
        </div>
        
        <!-- Boutique -->
        <div id="shop" class="screen hidden">
            <button class="btn" onclick="showScreen('menu')">‚Üê Retour</button>
            <div class="card">
                <h2 class="text-2xl font-bold text-center mb-4">üõí Boutique</h2>
                <p class="text-center mb-6">Argent disponible: <span id="shop-money">25,000‚Ç¨</span></p>
                
                <!-- Am√©liorations du bateau -->
                <h3 class="font-bold mb-4">Am√©liorations du Bateau</h3>
                <div id="boat-upgrades">
                    <!-- Les am√©liorations seront ajout√©es dynamiquement -->
                </div>
                
                <!-- Pilote automatique -->
                <h3 class="font-bold mb-4 mt-6">ü§ñ Pilote Automatique</h3>
                <div id="autopilot-upgrades">
                    <!-- Les am√©liorations du pilote automatique seront ajout√©es dynamiquement -->
                </div>
            </div>
        </div>
        
        <!-- Sponsors -->
        <div id="sponsors" class="screen hidden">
            <button class="btn" onclick="showScreen('menu')">‚Üê Retour</button>
            <div class="card">
                <h2 class="text-2xl font-bold text-center mb-4">ü§ù Sponsors</h2>
                <div id="sponsors-list">
                    <!-- Les sponsors seront ajout√©s dynamiquement -->
                </div>
            </div>
        </div>
        
        <!-- Historique -->
        <div id="history" class="screen hidden">
            <button class="btn" onclick="showScreen('menu')">‚Üê Retour</button>
            <div class="card">
                <h2 class="text-2xl font-bold text-center mb-4">üìä Historique</h2>
                
                <h3 class="font-bold mb-4">Derni√®res Courses</h3>
                <div id="race-history">
                    <p class="text-center" style="color: #6b7280;">Aucune course termin√©e</p>
                </div>
                
                <h3 class="font-bold mb-4 mt-6">Championnats Termin√©s</h3>
                <div id="championship-history">
                    <p class="text-center" style="color: #6b7280;">Aucun championnat termin√©</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales du jeu
        let gameData = {
            money: 25000,
            xp: 0,
            level: 1,
            boat: {
                speed: 10,
                handling: 10,
                endurance: 10
            },
            autopilot: {
                level: 1,
                name: "Basic",
                efficiency: 0.8
            },
            sponsors: [],
            raceHistory: [],
            championships: [],
            unlockedChampionships: ['amateur']
        };
        
        let raceState = {
            isRacing: false,
            isAutopilot: true,
            sailTrim: 50,
            position: 1,
            progress: 0,
            competitors: [],
            timeLeft: 0,
            weather: 'normal',
            difficulty: 'debutant',
            duration: 5 // en minutes
        };
        
        let championshipState = {
            isActive: false,
            currentRace: 0,
            totalRaces: 20,
            playerPoints: 0,
            standings: [],
            championshipData: null
        };
        
        let raceInterval = null;
        
        // Donn√©es statiques
        const autopilotLevels = [
            { level: 1, name: "Basic", efficiency: 0.8, cost: 0 },
            { level: 2, name: "Avanc√©", efficiency: 0.9, cost: 5000 },
            { level: 3, name: "Expert", efficiency: 0.95, cost: 15000 },
            { level: 4, name: "IA Elite", efficiency: 0.98, cost: 50000 }
        ];
        
        const championships = [
            { id: 'amateur', name: 'Championnat Amateur', cost: 0, requirement: 1, difficulty: 'debutant', 
              prize1: 50000, prize2: 25000, prize3: 10000 },
            { id: 'pro', name: 'Championnat Pro', cost: 15000, requirement: 5, difficulty: 'intermediaire',
              prize1: 100000, prize2: 50000, prize3: 25000 },
            { id: 'elite', name: 'Championnat Elite', cost: 50000, requirement: 15, difficulty: 'expert',
              prize1: 250000, prize2: 125000, prize3: 60000 }
        ];
        
        const sponsors = [
            { name: "Marine Pro", bonus: 1000, requirement: 5 },
            { name: "Ocean Master", bonus: 2500, requirement: 10 },
            { name: "Sailing Elite", bonus: 5000, requirement: 20 }
        ];
        
        // Sauvegarde et chargement
        function saveGame() {
            try {
                const saveData = {
                    gameData: gameData,
                    championshipState: championshipState
                };
                localStorage.setItem('sailingGame', JSON.stringify(saveData));
            } catch (error) {
                console.warn('Erreur sauvegarde:', error);
            }
        }
        
        function loadGame() {
            try {
                const saved = localStorage.getItem('sailingGame');
                if (saved) {
                    const saveData = JSON.parse(saved);
                    gameData = { ...gameData, ...saveData.gameData };
                    championshipState = { ...championshipState, ...saveData.championshipState };
                }
            } catch (error) {
                console.warn('Erreur chargement:', error);
            }
        }
        
        // Fonctions d'affichage
        function showScreen(screenName) {
            // Cacher tous les √©crans
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.add('hidden'));
            
            // Afficher l'√©cran demand√©
            document.getElementById(screenName).classList.remove('hidden');
            
            // Mettre √† jour l'affichage selon l'√©cran
            updateDisplay();
        }
        
        function updateDisplay() {
            // Mettre √† jour les stats du joueur
            document.getElementById('player-money').textContent = formatMoney(gameData.money);
            document.getElementById('player-xp').textContent = gameData.xp;
            document.getElementById('player-level').textContent = gameData.level;
            document.getElementById('shop-money').textContent = formatMoney(gameData.money);
            
            // Mettre √† jour le statut de course
            updateRaceStatus();
            
            // Mettre √† jour les boutons de difficult√©
            updateDifficultyButtons();
            
            // Mettre √† jour les listes (boutique, sponsors, etc.)
            updateShop();
            updateSponsors();
            updateChampionships();
            updateHistory();
        }
        
        function updateRaceStatus() {
            const statusDiv = document.getElementById('race-status');
            if (raceState.isRacing) {
                statusDiv.classList.remove('hidden');
                document.getElementById('current-position').textContent = raceState.position;
                document.getElementById('time-remaining').textContent = formatTime(raceState.timeLeft);
            } else {
                statusDiv.classList.add('hidden');
            }
        }
        
        function updateDifficultyButtons() {
            ['debutant', 'intermediaire', 'expert'].forEach(diff => {
                const btn = document.getElementById('diff-' + diff);
                if (raceState.difficulty === diff) {
                    btn.classList.add('btn-green');
                    btn.classList.remove('btn');
                } else {
                    btn.classList.add('btn');
                    btn.classList.remove('btn-green');
                }
            });
        }
        
        // Configuration de course
        function setDifficulty(difficulty) {
            raceState.difficulty = difficulty;
            updateDifficultyButtons();
        }
        
        function updateDuration() {
            const slider = document.getElementById('duration-slider');
            const value = parseInt(slider.value);
            raceState.duration = value;
            
            let displayText;
            if (value < 60) {
                displayText = value + ' minute' + (value > 1 ? 's' : '');
            } else if (value < 1440) {
                const hours = Math.floor(value / 60);
                displayText = hours + ' heure' + (hours > 1 ? 's' : '');
            } else {
                const days = Math.floor(value / 1440);
                displayText = days + ' jour' + (days > 1 ? 's' : '');
            }
            
            document.getElementById('duration-display').textContent = displayText;
        }
        
        // D√©marrage de course
        function startRace() {
            if (raceState.isRacing) return;
            
            raceState.isRacing = true;
            raceState.timeLeft = raceState.duration * 60; // Convertir en secondes
            raceState.progress = 0;
            raceState.position = 1;
            raceState.sailTrim = 50;
            raceState.weather = ['calme', 'normal', 'venteux'][Math.floor(Math.random() * 3)];
            
            // G√©n√©rer les adversaires
            generateCompetitors();
            
            // Aller √† l'√©cran de course
            showScreen('race');
            
            // D√©marrer la boucle de course
            startRaceLoop();
        }
        
        function generateCompetitors() {
            raceState.competitors = [];
            const baseSpeed = raceState.difficulty === 'debutant' ? 8 : 
                             raceState.difficulty === 'intermediaire' ? 12 : 16;
            
            for (let i = 0; i < 7; i++) {
                raceState.competitors.push({
                    id: i,
                    name: 'Adversaire ' + (i + 1),
                    speed: baseSpeed + Math.random() * 4,
                    progress: 0
                });
            }
        }
        
        function startRaceLoop() {
            if (raceInterval) clearInterval(raceInterval);
            
            raceInterval = setInterval(() => {
                if (!raceState.isRacing) {
                    clearInterval(raceInterval);
                    return;
                }
                
                updateRaceStep();
                updateRaceDisplay();
                
                // V√©rifier fin de course
                if (raceState.timeLeft <= 0 || raceState.progress >= 100) {
                    finishRace();
                }
                
            }, 1000);
        }
        
        function updateRaceStep() {
            raceState.timeLeft--;
            
            // Pilote automatique
            if (raceState.isAutopilot) {
                const autopilot = autopilotLevels.find(a => a.level === gameData.autopilot.level);
                let targetTrim = 50;
                
                if (raceState.weather === 'calme') targetTrim = 40;
                else if (raceState.weather === 'venteux') targetTrim = 60;
                
                raceState.sailTrim = targetTrim;
            }
            
            // Calcul progression joueur
            const weatherMultiplier = raceState.weather === 'calme' ? 0.8 : 
                                     raceState.weather === 'venteux' ? 1.2 : 1.0;
            
            let trimEfficiency = 1 - Math.abs(50 - raceState.sailTrim) / 100;
            if (raceState.isAutopilot) {
                const autopilot = autopilotLevels.find(a => a.level === gameData.autopilot.level);
                trimEfficiency = Math.max(trimEfficiency, autopilot.efficiency);
            }
            
            const baseProgress = 100 / (raceState.duration * 60);
            const playerSpeed = (gameData.boat.speed / 10) * weatherMultiplier * trimEfficiency;
            raceState.progress = Math.min(raceState.progress + baseProgress * playerSpeed, 100);
            
            // Progression adversaires
            raceState.competitors.forEach(comp => {
                const compSpeed = (comp.speed / 10) * (0.9 + Math.random() * 0.2);
                comp.progress = Math.min(comp.progress + baseProgress * compSpeed, 100);
            });
            
            // Calcul position
            const allRacers = [
                { progress: raceState.progress, isPlayer: true },
                ...raceState.competitors
            ];
            allRacers.sort((a, b) => b.progress - a.progress);
            raceState.position = allRacers.findIndex(r => r.isPlayer) + 1;
        }
        
        function updateRaceDisplay() {
            document.getElementById('race-position').textContent = raceState.position + '/8';
            document.getElementById('race-time').textContent = formatTime(raceState.timeLeft);
            document.getElementById('race-progress').textContent = Math.round(raceState.progress) + '%';
            document.getElementById('sail-value').textContent = raceState.sailTrim;
            
            // M√©t√©o
            const weatherIcons = { calme: 'üò¥', normal: 'üåä', venteux: 'üí®' };
            document.getElementById('weather').textContent = 
                weatherIcons[raceState.weather] + ' ' + raceState.weather.charAt(0).toUpperCase() + raceState.weather.slice(1);
            
            // Statut des voiles
            const sailStatus = document.getElementById('sail-status');
            if (Math.abs(50 - raceState.sailTrim) < 10) {
                sailStatus.textContent = 'OPTIMUM';
                sailStatus.className = 'optimum';
            } else {
                sailStatus.textContent = '√Ä AJUSTER';
                sailStatus.className = 'not-optimum';
            }
            
            // Mettre √† jour le slider des voiles
            document.getElementById('sail-slider').value = raceState.sailTrim;
            
            // Mettre √† jour la visualisation de la course
            updateRaceVisualization();
            updateRanking();
        }
        
        function updateRaceVisualization() {
            const track = document.getElementById('race-track');
            
            // Nettoyer les bateaux existants
            const existingBoats = track.querySelectorAll('.boat');
            existingBoats.forEach(boat => boat.remove());
            
            // Ajouter le bateau du joueur
            const playerBoat = document.createElement('div');
            playerBoat.className = 'boat boat-player';
            playerBoat.innerHTML = '‚õµ';
            playerBoat.style.left = Math.min(raceState.progress, 95) + '%';
            playerBoat.style.top = '20px';
            track.appendChild(playerBoat);
            
            // Ajouter les bateaux adversaires
            raceState.competitors.forEach((comp, index) => {
                const boat = document.createElement('div');
                boat.className = 'boat';
                boat.innerHTML = 'üö§';
                boat.style.left = Math.min(comp.progress, 95) + '%';
                boat.style.top = (40 + index * 8) + 'px';
                track.appendChild(boat);
            });
        }
        
        function updateRanking() {
            const rankingDiv = document.getElementById('race-ranking');
            const allRacers = [
                { name: 'Vous', progress: raceState.progress, isPlayer: true },
                ...raceState.competitors
            ];
            allRacers.sort((a, b) => b.progress - a.progress);
            
            let html = '';
            allRacers.forEach((racer, index) => {
                const position = index + 1;
                const medal = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : position;
                const playerClass = racer.isPlayer ? 'font-bold' : '';
                const bgColor = racer.isPlayer ? 'background: #dbeafe;' : 'background: #f9fafb;';
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; 
                                padding: 8px; margin: 4px 0; border-radius: 6px; ${bgColor}">
                        <span class="${playerClass}">
                            ${medal} ${racer.name}
                        </span>
                        <span class="${playerClass}">${Math.round(racer.progress)}%</span>
                    </div>
                `;
            });
            rankingDiv.innerHTML = html;
        }
        
        function toggleAutopilot() {
            raceState.isAutopilot = !raceState.isAutopilot;
            const btn = document.getElementById('autopilot-btn');
            const slider = document.getElementById('sail-slider');
            
            if (raceState.isAutopilot) {
                btn.textContent = 'ü§ñ Pilote Auto: ON';
                btn.className = 'btn btn-green';
                slider.disabled = true;
            } else {
                btn.textContent = 'ü§ñ Pilote Auto: OFF';
                btn.className = 'btn';
                slider.disabled = false;
            }
            
            // Mettre √† jour l'efficacit√©
            const autopilot = autopilotLevels.find(a => a.level === gameData.autopilot.level);
            document.getElementById('autopilot-efficiency').textContent = 
                'Efficacit√©: ' + Math.round(autopilot.efficiency * 100) + '%';
        }
        
        function updateSails() {
            if (!raceState.isAutopilot) {
                raceState.sailTrim = parseInt(document.getElementById('sail-slider').value);
                document.getElementById('sail-value').textContent = raceState.sailTrim;
            }
        }
        
        function finishRace() {
            raceState.isRacing = false;
            clearInterval(raceInterval);
            
            const position = raceState.position;
            const isWinner = raceState.progress >= 100 && position === 1;
            
            // Calcul des r√©compenses
            let prize = 0;
            let xp = 0;
            
            if (championshipState.isActive) {
                // Course de championnat
                const points = [25, 18, 15, 12, 10, 8, 6, 4, 2, 1][position - 1] || 0;
                championshipState.playerPoints += points;
                championshipState.currentRace++;
                
                prize = Math.max(1000, 500 * (9 - position));
                xp = Math.max(25, 100 - position * 10);
                
                // V√©rifier fin de championnat
                if (championshipState.currentRace > 20) {
                    finishChampionship();
                }
            } else {
                // Course libre
                prize = isWinner ? 8000 : position <= 3 ? 3000 : 1000;
                xp = isWinner ? 150 : position <= 3 ? 75 : 25;
            }
            
            // Appliquer les r√©compenses
            gameData.money += prize;
            gameData.xp += xp;
            gameData.level = Math.floor(gameData.xp / 100) + 1;
            
            // Ajouter √† l'historique
            gameData.raceHistory.push({
                date: new Date().toLocaleDateString(),
                position: position,
                prize: prize,
                xp: xp,
                difficulty: raceState.difficulty,
                duration: raceState.duration,
                type: championshipState.isActive ? 'Championnat' : 'Course libre'
            });
            
            // Sauvegarder et mettre √† jour
            saveGame();
            updateDisplay();
            
            // Afficher les r√©sultats
            alert(`Course termin√©e !\\nPosition: ${position}/8\\nGains: ${formatMoney(prize)} + ${xp} XP`);
        }
        
        function finishChampionship() {
            // Calculer la position finale du championnat
            const finalPosition = 1; // Simplification - √† calculer selon les points
            let championshipPrize = 0;
            
            if (finalPosition === 1) championshipPrize = championshipState.championshipData.prize1;
            else if (finalPosition === 2) championshipPrize = championshipState.championshipData.prize2;
            else if (finalPosition === 3) championshipPrize = championshipState.championshipData.prize3;
            
            gameData.money += championshipPrize;
            gameData.championships.push({
                name: championshipState.championshipData.name,
                date: new Date().toLocaleDateString(),
                position: finalPosition,
                points: championshipState.playerPoints,
                prize: championshipPrize
            });
            
            championshipState.isActive = false;
            championshipState.currentRace = 0;
            championshipState.playerPoints = 0;
            
            alert(`Championnat termin√© !\\nPosition finale: ${finalPosition}\\nPrix: ${formatMoney(championshipPrize)}`);
        }
        
        // Boutique
        function updateShop() {
            const boatUpgrades = document.getElementById('boat-upgrades');
            const upgrades = [
                { stat: 'speed', name: 'Vitesse', current: gameData.boat.speed, cost: 1000 },
                { stat: 'handling', name: 'Maniabilit√©', current: gameData.boat.handling, cost: 1200 },
                { stat: 'endurance', name: 'Endurance', current: gameData.boat.endurance, cost: 800 }
            ];
            
            let html = '';
            upgrades.forEach(upgrade => {
                const canAfford = gameData.money >= upgrade.cost;
                const btnClass = canAfford ? 'btn btn-green' : 'btn';
                const disabled = canAfford ? '' : 'disabled';
                
                html += `
                    <div class="upgrade-item">
                        <div>
                            <div class="font-bold">${upgrade.name}</div>
                            <div>Niveau actuel: ${upgrade.current}</div>
                            <div style="color: #10b981; font-weight: bold;">${formatMoney(upgrade.cost)}</div>
                        </div>
                        <button class="${btnClass}" onclick="upgradeBoat('${upgrade.stat}', ${upgrade.cost})" ${disabled}>
                            Am√©liorer
                        </button>
                    </div>
                `;
            });
            boatUpgrades.innerHTML = html;
            
            // Pilote automatique
            const autopilotDiv = document.getElementById('autopilot-upgrades');
            const currentLevel = gameData.autopilot.level;
            const currentAutopilot = autopilotLevels.find(a => a.level === currentLevel);
            
            let autopilotHtml = `
                <div class="upgrade-item">
                    <div>
                        <div class="font-bold">Niveau Actuel: ${currentAutopilot.name}</div>
                        <div>Efficacit√©: ${Math.round(currentAutopilot.efficiency * 100)}%</div>
                    </div>
                    <div style="font-size: 24px;">ü§ñ</div>
                </div>
            `;
            
            if (currentLevel < 4) {
                const nextLevel = autopilotLevels.find(a => a.level === currentLevel + 1);
                const canAfford = gameData.money >= nextLevel.cost;
                const btnClass = canAfford ? 'btn btn-green' : 'btn';
                const disabled = canAfford ? '' : 'disabled';
                
                autopilotHtml += `
                    <div class="upgrade-item">
                        <div>
                            <div class="font-bold">Prochaine am√©lioration: ${nextLevel.name}</div>
                            <div>Efficacit√©: ${Math.round(nextLevel.efficiency * 100)}%</div>
                            <div style="color: #10b981; font-weight: bold;">${formatMoney(nextLevel.cost)}</div>
                        </div>
                        <button class="${btnClass}" onclick="upgradeAutopilot(${nextLevel.cost}, ${nextLevel.level})" ${disabled}>
                            Am√©liorer
                        </button>
                    </div>
                `;
            } else {
                autopilotHtml += `
                    <div class="upgrade-item" style="background: #fef3c7;">
                        <div class="font-bold text-center">üèÜ NIVEAU MAXIMUM ATTEINT !</div>
                    </div>
                `;
            }
            
            autopilotDiv.innerHTML = autopilotHtml;
        }
        
        function upgradeBoat(stat, cost) {
            if (gameData.money >= cost) {
                gameData.money -= cost;
                gameData.boat[stat]++;
                saveGame();
                updateDisplay();
            }
        }
        
        function upgradeAutopilot(cost, newLevel) {
            if (gameData.money >= cost) {
                gameData.money -= cost;
                const newAutopilot = autopilotLevels.find(a => a.level === newLevel);
                gameData.autopilot = {
                    level: newLevel,
                    name: newAutopilot.name,
                    efficiency: newAutopilot.efficiency
                };
                saveGame();
                updateDisplay();
            }
        }
        
        // Sponsors
        function updateSponsors() {
            const sponsorsDiv = document.getElementById('sponsors-list');
            let html = '';
            
            sponsors.forEach(sponsor => {
                const hasRequirement = gameData.level >= sponsor.requirement;
                const hasContract = gameData.sponsors.includes(sponsor.name);
                
                let statusHtml = '';
                if (hasContract) {
                    statusHtml = '<span class="btn btn-green" style="cursor: default;">Contrat Actif</span>';
                } else if (hasRequirement) {
                    statusHtml = `<button class="btn btn-purple" onclick="signSponsor('${sponsor.name}', ${sponsor.bonus})">Signer le Contrat</button>`;
                } else {
                    statusHtml = '<span class="btn" style="cursor: default;">Niveau Insuffisant</span>';
                }
                
                html += `
                    <div class="sponsor-item">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div class="font-bold text-lg">${sponsor.name}</div>
                                <div>Bonus: ${formatMoney(sponsor.bonus)}</div>
                                <div>Niveau requis: ${sponsor.requirement}</div>
                            </div>
                            <div>${statusHtml}</div>
                        </div>
                    </div>
                `;
            });
            
            sponsorsDiv.innerHTML = html;
        }
        
        function signSponsor(name, bonus) {
            gameData.money += bonus;
            gameData.sponsors.push(name);
            saveGame();
            updateDisplay();
            alert(`Contrat sign√© avec ${name} !\\nBonus re√ßu: ${formatMoney(bonus)}`);
        }
        
        // Championnats
        function updateChampionships() {
            const champDiv = document.getElementById('championships-list');
            
            // Afficher championnat actif
            const activeDiv = document.getElementById('active-championship');
            if (championshipState.isActive) {
                activeDiv.classList.remove('hidden');
                document.getElementById('active-champ-name').textContent = championshipState.championshipData.name;
                document.getElementById('champ-current-race').textContent = championshipState.currentRace + '/20';
                document.getElementById('champ-your-points').textContent = championshipState.playerPoints;
                document.getElementById('champ-your-position').textContent = '1er'; // Simplification
            } else {
                activeDiv.classList.add('hidden');
            }
            
            // Liste des championnats
            let html = '';
            championships.forEach(champ => {
                const isUnlocked = gameData.unlockedChampionships.includes(champ.id);
                const canUnlock = gameData.level >= champ.requirement && gameData.money >= champ.cost;
                
                let actionHtml = '';
                if (!isUnlocked && champ.cost > 0) {
                    const btnClass = canUnlock ? 'btn btn-yellow' : 'btn';
                    const disabled = canUnlock ? '' : 'disabled';
                    actionHtml = `<button class="${btnClass}" onclick="unlockChampionship('${champ.id}', ${champ.cost})" ${disabled}>D√©verrouiller (${formatMoney(champ.cost)})</button>`;
                } else if (isUnlocked && !championshipState.isActive) {
                    actionHtml = `
                        <div>
                            <select id="champ-duration-${champ.id}">
                                <option value="5">5 minutes</option>
                                <option value="15">15 minutes</option>
                                <option value="60">1 heure</option>
                                <option value="180">3 heures</option>
                            </select>
                            <button class="btn btn-green" onclick="startChampionship('${champ.id}')">Commencer</button>
                        </div>
                    `;
                } else if (championshipState.isActive) {
                    actionHtml = '<span class="btn" style="cursor: default;">Championnat en cours</span>';
                } else {
                    actionHtml = '<span class="btn btn-green" style="cursor: default;">D√©verrouill√©</span>';
                }
                
                html += `
                    <div class="upgrade-item">
                        <div>
                            <div class="font-bold text-lg">${champ.name}</div>
                            <div>Difficult√©: ${champ.difficulty}</div>
                            <div>Niveau requis: ${champ.requirement}</div>
                            <div style="color: #f59e0b; font-weight: bold;">
                                ü•á ${formatMoney(champ.prize1)} | ü•à ${formatMoney(champ.prize2)} | ü•â ${formatMoney(champ.prize3)}
                            </div>
                        </div>
                        <div>${actionHtml}</div>
                    </div>
                `;
            });
            
            champDiv.innerHTML = html;
        }
        
        function unlockChampionship(champId, cost) {
            if (gameData.money >= cost) {
                gameData.money -= cost;
                gameData.unlockedChampionships.push(champId);
                saveGame();
                updateDisplay();
                alert(`Championnat d√©verrouill√© !`);
            }
        }
        
        function startChampionship(champId) {
            const championship = championships.find(c => c.id === champId);
            const durationSelect = document.getElementById('champ-duration-' + champId);
            const duration = parseInt(durationSelect.value);
            
            championshipState.isActive = true;
            championshipState.currentRace = 1;
            championshipState.playerPoints = 0;
            championshipState.championshipData = championship;
            
            raceState.difficulty = championship.difficulty;
            raceState.duration = duration;
            
            saveGame();
            alert(`Championnat ${championship.name} commenc√© !\\n20 courses vous attendent.`);
            updateDisplay();
        }
        
        // Historique
        function updateHistory() {
            const raceHistoryDiv = document.getElementById('race-history');
            const champHistoryDiv = document.getElementById('championship-history');
            
            // Historique des courses
            if (gameData.raceHistory.length === 0) {
                raceHistoryDiv.innerHTML = '<p class="text-center" style="color: #6b7280;">Aucune course termin√©e</p>';
            } else {
                let html = '';
                gameData.raceHistory.slice(-10).reverse().forEach(race => {
                    const medal = race.position === 1 ? 'ü•á' : race.position === 2 ? 'ü•à' : race.position === 3 ? 'ü•â' : race.position + 'e';
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; 
                                    background: #f9fafb; padding: 12px; margin: 8px 0; border-radius: 6px;">
                            <div>
                                <div class="font-bold">${race.date} - ${race.type}</div>
                                <div>Difficult√©: ${race.difficulty} | Dur√©e: ${race.duration} min</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="font-bold">${medal}</div>
                                <div style="color: #10b981;">+${formatMoney(race.prize)}</div>
                                <div style="color: #3b82f6;">+${race.xp} XP</div>
                            </div>
                        </div>
                    `;
                });
                raceHistoryDiv.innerHTML = html;
            }
            
            // Historique des championnats
            if (gameData.championships.length === 0) {
                champHistoryDiv.innerHTML = '<p class="text-center" style="color: #6b7280;">Aucun championnat termin√©</p>';
            } else {
                let html = '';
                gameData.championships.forEach(champ => {
                    const medal = champ.position === 1 ? 'üèÜ' : champ.position === 2 ? 'ü•à' : champ.position === 3 ? 'ü•â' : champ.position + 'e';
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; 
                                    background: #fef3c7; padding: 12px; margin: 8px 0; border-radius: 6px;">
                            <div>
                                <div class="font-bold">${champ.name}</div>
                                <div>${champ.date}</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="font-bold">${medal}</div>
                                <div style="color: #3b82f6;">${champ.points} pts</div>
                                <div style="color: #10b981;">+${formatMoney(champ.prize)}</div>
                            </div>
                        </div>
                    `;
                });
                champHistoryDiv.innerHTML = html;
            }
        }
        
        // Fonctions utilitaires
        function formatMoney(amount) {
            return amount.toLocaleString() + '‚Ç¨';
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins + ':' + secs.toString().padStart(2, '0');
        }
        
        // Initialisation du jeu
        function initGame() {
            loadGame();
            updateDisplay();
            updateDuration();
            
            // Afficher le menu principal
            showScreen('menu');
        }
        
        // D√©marrer le jeu quand la page est charg√©e
        window.addEventListener('load', initGame);
    </script>
</body>
</html>