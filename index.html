<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Championnat de Voile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #60a5fa, #2563eb);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .grid-5 {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #059669;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }
        
        .btn-yellow {
            background: #f59e0b;
            color: white;
        }
        
        .btn-yellow:hover:not(:disabled) {
            background: #d97706;
        }
        
        .btn-blue {
            background: #3b82f6;
            color: white;
        }
        
        .btn-blue:hover:not(:disabled) {
            background: #2563eb;
        }
        
        .btn-orange {
            background: #f97316;
            color: white;
        }
        
        .btn-orange:hover:not(:disabled) {
            background: #ea580c;
        }
        
        .btn-purple {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-purple:hover:not(:disabled) {
            background: #7c3aed;
        }
        
        .stat-card {
            text-align: center;
            padding: 16px;
            border-radius: 8px;
        }
        
        .stat-green {
            background: #d1fae5;
            color: #065f46;
        }
        
        .stat-blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .stat-purple {
            background: #e9d5ff;
            color: #6b21a8;
        }
        
        .stat-yellow {
            background: #fef3c7;
            color: #92400e;
        }
        
        .text-2xl {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .text-3xl {
            font-size: 1.875rem;
            font-weight: bold;
        }
        
        .text-4xl {
            font-size: 2.25rem;
            font-weight: bold;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-white {
            color: white;
        }
        
        .mb-2 {
            margin-bottom: 8px;
        }
        
        .mb-4 {
            margin-bottom: 16px;
        }
        
        .mb-6 {
            margin-bottom: 24px;
        }
        
        .mb-8 {
            margin-bottom: 32px;
        }
        
        .mt-4 {
            margin-top: 16px;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-col {
            flex-direction: column;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .justify-center {
            justify-content: center;
        }
        
        .items-center {
            align-items: center;
        }
        
        .gap-2 {
            gap: 8px;
        }
        
        .gap-3 {
            gap: 12px;
        }
        
        .gap-4 {
            gap: 16px;
        }
        
        .w-full {
            width: 100%;
        }
        
        .hidden {
            display: none;
        }
        
        .font-bold {
            font-weight: bold;
        }
        
        .text-lg {
            font-size: 1.125rem;
        }
        
        .text-xl {
            font-size: 1.25rem;
        }
        
        .space-y-2 > * + * {
            margin-top: 8px;
        }
        
        .space-y-3 > * + * {
            margin-top: 12px;
        }
        
        .space-y-4 > * + * {
            margin-top: 16px;
        }
        
        .space-y-6 > * + * {
            margin-top: 24px;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
        
        select {
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
        }
        
        .race-track {
            position: relative;
            background: linear-gradient(to right, #bfdbfe, #60a5fa);
            height: 128px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .finish-line {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 8px;
            background: #dc2626;
            opacity: 0.7;
        }
        
        .racer {
            position: absolute;
            transition: all 1s ease-out;
            transform: translateX(-50%);
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translateY(0) translateX(-50%);
            }
            40%, 43% {
                transform: translateY(-10px) translateX(-50%);
            }
            70% {
                transform: translateY(-5px) translateX(-50%);
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .status-bar {
            background: #10b981;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .upgrade-section {
            background: #eff6ff;
            border: 2px solid #bfdbfe;
            padding: 16px;
            border-radius: 8px;
        }
        
        .championship-active {
            background: #fef3c7;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        
        .championship-item {
            background: #f3f4f6;
            padding: 24px;
            border-radius: 8px;
        }
        
        .position-1 {
            background: #f59e0b;
            color: white;
        }
        
        .position-2 {
            background: #9ca3af;
            color: white;
        }
        
        .position-3 {
            background: #ea580c;
            color: white;
        }
        
        .position-other {
            background: #6b7280;
            color: white;
        }
        
        .progress-indicators {
            position: absolute;
            bottom: 8px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #6b7280;
            padding: 0 8px;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script>
        // Variables globales
        let gameData = {};
        let championshipState = {};
        let raceState = {};
        let raceSettings = {};
        let currentScreen = 'menu';
        let raceInterval = null;
        
        // Niveaux de pilote automatique
        const autopilotLevels = [
            { level: 1, name: "Basic", efficiency: 0.8, cost: 0, description: "R√©glage fixe √† 50%" },
            { level: 2, name: "Avanc√©", efficiency: 0.9, cost: 5000, description: "Adaptation lente aux conditions" },
            { level: 3, name: "Expert", efficiency: 0.95, cost: 15000, description: "R√©action rapide aux changements" },
            { level: 4, name: "IA Elite", efficiency: 0.98, cost: 50000, description: "Optimisation parfaite temps r√©el" }
        ];
        
        // Championnats disponibles
        const availableChampionships = [
            { 
                id: 'amateur', 
                name: 'Championnat Amateur', 
                cost: 0, 
                requirement: 1, 
                difficulty: 'debutant',
                prize1: 50000,
                prize2: 25000,
                prize3: 10000
            },
            { 
                id: 'pro', 
                name: 'Championnat Pro', 
                cost: 15000, 
                requirement: 5, 
                difficulty: 'intermediaire',
                prize1: 100000,
                prize2: 50000,
                prize3: 25000
            },
            { 
                id: 'elite', 
                name: 'Championnat Elite', 
                cost: 50000, 
                requirement: 15, 
                difficulty: 'expert',
                prize1: 250000,
                prize2: 125000,
                prize3: 60000
            }
        ];
        
        // Sponsors disponibles
        const availableSponsors = [
            { name: "Marine Pro", bonus: 1000, requirement: 5 },
            { name: "Ocean Master", bonus: 2500, requirement: 10 },
            { name: "Sailing Elite", bonus: 5000, requirement: 20 }
        ];
        
        // Fonction de sauvegarde
        function saveGameData(data) {
            try {
                localStorage.setItem('sailingChampionshipGame', JSON.stringify(data));
            } catch (error) {
                console.warn('Sauvegarde impossible:', error);
            }
        }
        
        // Fonction de chargement
        function loadGameData() {
            try {
                const saved = localStorage.getItem('sailingChampionshipGame');
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (error) {
                console.warn('Chargement impossible:', error);
            }
            return null;
        }
        
        // Initialisation du jeu
        function initGame() {
            const savedData = loadGameData();
            
            gameData = savedData || {
                money: 25000,
                xp: 0,
                level: 1,
                boat: {
                    name: "Mon Voilier",
                    speed: 10,
                    handling: 10,
                    endurance: 10
                },
                autopilot: {
                    level: 1,
                    name: "Basic"
                },
                sponsors: [],
                raceHistory: [],
                championships: [],
                unlockedChampionships: ['amateur']
            };
            
            championshipState = savedData?.championshipState || {
                isActive: false,
                currentRace: 0,
                totalRaces: 20,
                level: 'amateur',
                standings: [],
                playerPoints: 0,
                championshipData: null,
                raceDuration: 300
            };
            
            raceSettings = {
                difficulty: 'debutant',
                duration: 60
            };
            
            raceState = {
                isRacing: false,
                isAutoPilot: true,
                sailTrim: 50,
                position: 1,
                progress: 0,
                competitors: [],
                timeLeft: 0,
                weatherConditions: 'normal'
            };
            
            renderScreen();
        }
        
        // Sauvegarder automatiquement
        function autoSave() {
            const dataToSave = {
                ...gameData,
                championshipState: championshipState
            };
            saveGameData(dataToSave);
        }
        
        // Am√©liorer le pilote automatique
        function upgradeAutopilot(cost, newLevel) {
            if (gameData.money >= cost) {
                const newAutopilotData = autopilotLevels.find(ap => ap.level === newLevel);
                gameData.money -= cost;
                gameData.autopilot = {
                    level: newLevel,
                    name: newAutopilotData.name
                };
                autoSave();
                renderScreen();
            }
        }
        
        // D√©verrouiller un championnat
        function unlockChampionship(championshipId, cost) {
            if (gameData.money >= cost) {
                gameData.money -= cost;
                gameData.unlockedChampionships.push(championshipId);
                autoSave();
                renderScreen();
            }
        }
        
        // Am√©liorer le bateau
        function upgradeBoat(stat, cost) {
            if (gameData.money >= cost) {
                gameData.money -= cost;
                gameData.boat[stat] += 1;
                autoSave();
                renderScreen();
            }
        }
        
        // G√©n√©rer des concurrents
        function generateCompetitors(difficulty) {
            const baseSpeed = difficulty === 'debutant' ? 8 : difficulty === 'intermediaire' ? 12 : 16;
            const competitors = [];
            for (let i = 0; i < 7; i++) {
                competitors.push({
                    id: i,
                    name: `Concurrent ${i + 1}`,
                    speed: baseSpeed + Math.random() * 4,
                    progress: 0
                });
            }
            return competitors;
        }
        
        // Commencer une course
        function startRace() {
            if (championshipState.isActive && championshipState.currentRace <= 20) {
                startChampionshipRace(championshipState.level, championshipState.standings, championshipState.raceDuration);
                return;
            }
            
            const competitors = generateCompetitors(raceSettings.difficulty);
            raceState = {
                isRacing: true,
                isAutoPilot: true,
                sailTrim: 50,
                position: 1,
                progress: 0,
                competitors,
                timeLeft: raceSettings.duration,
                weatherConditions: ['calme', 'normal', 'venteux'][Math.floor(Math.random() * 3)]
            };
            currentScreen = 'race';
            renderScreen();
            startRaceLoop();
        }
        
        // Commencer un championnat
        function startChampionship(championship, raceDuration = 300) {
            const championshipCompetitors = [];
            for (let i = 0; i < 7; i++) {
                const baseSpeed = championship.difficulty === 'debutant' ? 8 : 
                                 championship.difficulty === 'intermediaire' ? 12 : 16;
                championshipCompetitors.push({
                    id: i,
                    name: `Pilote ${String.fromCharCode(65 + i)}`,
                    speed: baseSpeed + Math.random() * 2,
                    totalPoints: 0
                });
            }
            
            championshipState = {
                isActive: true,
                currentRace: 1,
                totalRaces: 20,
                level: championship.difficulty,
                standings: championshipCompetitors,
                playerPoints: 0,
                championshipData: championship,
                raceDuration: raceDuration
            };
            
            autoSave();
            startChampionshipRace(championship.difficulty, championshipCompetitors, raceDuration);
        }
        
        // Commencer une course de championnat
        function startChampionshipRace(difficulty, competitors, duration = 300) {
            raceSettings = { difficulty, duration };
            const raceCompetitors = competitors.map(comp => ({
                ...comp,
                progress: 0
            }));
            
            raceState = {
                isRacing: true,
                isAutoPilot: true,
                sailTrim: 50,
                position: 1,
                progress: 0,
                competitors: raceCompetitors,
                timeLeft: duration,
                weatherConditions: ['calme', 'normal', 'venteux'][Math.floor(Math.random() * 3)]
            };
            currentScreen = 'race';
            renderScreen();
            startRaceLoop();
        }
        
        // Boucle de course
        function startRaceLoop() {
            if (raceInterval) clearInterval(raceInterval);
            
            raceInterval = setInterval(() => {
                if (!raceState.isRacing) {
                    clearInterval(raceInterval);
                    return;
                }
                
                updateRace();
                renderScreen();
            }, 1000);
        }
        
        // Mise √† jour de la course
        function updateRace() {
            // Pilote automatique intelligent
            if (raceState.isAutoPilot) {
                const currentAutopilot = autopilotLevels.find(ap => ap.level === gameData.autopilot.level);
                let targetTrim = 50;
                
                if (currentAutopilot.level >= 2) {
                    if (raceState.weatherConditions === 'calme') targetTrim = 40;
                    else if (raceState.weatherConditions === 'venteux') targetTrim = 60;
                    
                    if (currentAutopilot.level >= 3) {
                        targetTrim += (Math.random() - 0.5) * 10;
                        targetTrim = Math.max(20, Math.min(80, targetTrim));
                    }
                    
                    if (currentAutopilot.level >= 4) {
                        targetTrim = 50 + (Math.sin(Date.now() / 10000) * 15);
                    }
                }
                
                const changeSpeed = currentAutopilot.level >= 4 ? 1 : 0.1;
                const newTrim = raceState.sailTrim + (targetTrim - raceState.sailTrim) * changeSpeed;
                
                if (Math.abs(newTrim - raceState.sailTrim) > 0.5) {
                    raceState.sailTrim = Math.round(newTrim);
                    return;
                }
            }
            
            if (raceState.timeLeft <= 0 || raceState.progress >= 100) {
                finishRace();
                return;
            }
            
            // Calculs de vitesse et progression
            const weatherMultiplier = raceState.weatherConditions === 'calme' ? 0.8 : 
                                     raceState.weatherConditions === 'venteux' ? 1.2 : 1.0;
            
            let trimEfficiency = 1 - Math.abs(50 - raceState.sailTrim) / 100;
            if (raceState.isAutoPilot) {
                const currentAutopilot = autopilotLevels.find(ap => ap.level === gameData.autopilot.level);
                trimEfficiency = Math.max(trimEfficiency, currentAutopilot.efficiency);
            }
            
            const baseProgressPerSecond = 100 / raceSettings.duration;
            const playerSpeedMultiplier = (gameData.boat.speed / 10) * weatherMultiplier * trimEfficiency;
            const playerProgressGain = baseProgressPerSecond * playerSpeedMultiplier;
            
            raceState.progress = Math.min(raceState.progress + playerProgressGain, 100);
            
            // Mise √† jour des concurrents
            raceState.competitors = raceState.competitors.map(comp => {
                const competitorSpeedMultiplier = (comp.speed / 10) * (0.9 + Math.random() * 0.2);
                const competitorProgressGain = baseProgressPerSecond * competitorSpeedMultiplier;
                return {
                    ...comp,
                    progress: Math.min(comp.progress + competitorProgressGain, 100)
                };
            });
            
            // Calcul de la position
            const allRacers = [{ progress: raceState.progress, isPlayer: true }, ...raceState.competitors];
            allRacers.sort((a, b) => b.progress - a.progress);
            raceState.position = allRacers.findIndex(racer => racer.isPlayer) + 1;
            
            raceState.timeLeft--;
        }
        
        // Fin de course
        function finishRace() {
            raceState.isRacing = false;
            const finalPosition = raceState.position;
            const isWinner = raceState.progress >= 100 && raceState.position === 1;
            
            const points = [25, 18, 15, 12, 10, 8, 6, 4, 2, 1][finalPosition - 1] || 0;
            let prize, xpGained;
            
            if (championshipState.isActive) {
                prize = Math.max(1000, 500 * (9 - finalPosition));
                xpGained = Math.max(25, 100 - finalPosition * 10);
                
                // Mise √† jour des points du championnat
                championshipState.standings = championshipState.standings.map(comp => {
                    const compPosition = raceState.competitors.findIndex(c => c.id === comp.id) + 2;
                    const compPoints = [25, 18, 15, 12, 10, 8, 6, 4, 2, 1][compPosition - 1] || 0;
                    return {
                        ...comp,
                        totalPoints: comp.totalPoints + compPoints
                    };
                });
                
                championshipState.playerPoints += points;
                championshipState.currentRace++;
                
                // V√©rifier si le championnat est termin√©
                if (championshipState.currentRace > 20) {
                    const allStandings = [
                        { name: "Vous", totalPoints: championshipState.playerPoints, isPlayer: true },
                        ...championshipState.standings
                    ].sort((a, b) => b.totalPoints - a.totalPoints);
                    
                    const playerFinalPosition = allStandings.findIndex(s => s.isPlayer) + 1;
                    let championshipPrize = 0;
                    
                    if (playerFinalPosition === 1) championshipPrize = championshipState.championshipData.prize1;
                    else if (playerFinalPosition === 2) championshipPrize = championshipState.championshipData.prize2;
                    else if (playerFinalPosition === 3) championshipPrize = championshipState.championshipData.prize3;
                    
                    gameData.money += prize + championshipPrize;
                    gameData.xp += xpGained + (playerFinalPosition <= 3 ? 500 : 100);
                    gameData.level = Math.floor((gameData.xp) / 100) + 1;
                    gameData.raceHistory.push({
                        date: new Date().toLocaleDateString(),
                        position: finalPosition,
                        prize: prize + championshipPrize,
                        xp: xpGained + (playerFinalPosition <= 3 ? 500 : 100),
                        difficulty: raceSettings.difficulty,
                        type: `Championnat ${championshipState.championshipData.name} - Position finale: ${playerFinalPosition}`
                    });
                    gameData.championships.push({
                        name: championshipState.championshipData.name,
                        date: new Date().toLocaleDateString(),
                        position: playerFinalPosition,
                        points: championshipState.playerPoints,
                        prize: championshipPrize
                    });
                    
                    championshipState.isActive = false;
                }
            } else {
                prize = isWinner ? 8000 : finalPosition === 1 ? 5000 : finalPosition <= 3 ? 2000 : 1000;
                xpGained = isWinner ? 150 : finalPosition === 1 ? 100 : finalPosition <= 3 ? 50 : 25;
                
                gameData.money += prize;
                gameData.xp += xpGained;
                gameData.level = Math.floor(gameData.xp / 100) + 1;
                gameData.raceHistory.push({
                    date: new Date().toLocaleDateString(),
                    position: finalPosition,
                    prize,
                    xp: xpGained,
                    difficulty: raceSettings.difficulty,
                    type: 'Course libre'
                });
            }
            
            autoSave();
            renderScreen();
        }
        
        // Signer un contrat de sponsor
        function signSponsor(sponsor) {
            gameData.money += sponsor.bonus;
            gameData.sponsors.push(sponsor.name);
            autoSave();
            renderScreen();
        }
        
        // Formatage des nombres
        function formatNumber(num) {
            return num.toLocaleString();
        }
        
        // Formatage du temps
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // Barre de statut de course
        function renderRaceStatusBar() {
            if (!raceState.isRacing) return '';
            
            return `
                <div class="status-bar animate-pulse">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span style="font-size: 1.5rem;">üèÅ</span>
                            <div>
                                <div class="font-bold">Course en cours !</div>
                                <div style="font-size: 0.875rem;">Position: ${raceState.position}/8 - Temps: ${formatTime(raceState.timeLeft)}</div>
                            </div>
                        </div>
                        <button class="btn btn-orange flex flex-col items-center gap-3" style="padding: 24px;" onclick="setScreen('shop')">
                            <i data-lucide="shopping-cart" style="width: 32px; height: 32px;"></i>
                            <span class="text-lg font-bold">Boutique</span>
                        </button>
                        
                        <button class="btn btn-purple flex flex-col items-center gap-3" style="padding: 24px;" onclick="setScreen('sponsors')">
                            <i data-lucide="settings" style="width: 32px; height: 32px;"></i>
                            <span class="text-lg font-bold">Sponsors</span>
                        </button>
                        
                        <button class="btn btn-blue flex flex-col items-center gap-3" style="padding: 24px;" onclick="setScreen('history')">
                            <i data-lucide="history" style="width: 32px; height: 32px;"></i>
                            <span class="text-lg font-bold">Historique</span>
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Configuration de course
        function renderRaceSetupScreen() {
            return `
                <div class="container" style="max-width: 800px;">
                    ${renderRaceStatusBar()}
                    
                    <button class="btn btn-secondary mb-6" onclick="setScreen('menu')">
                        ‚Üê Retour
                    </button>
                    
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-center">Configuration de Course</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="text-lg font-bold mb-3" style="display: block;">Difficult√©</label>
                                <div class="grid grid-3 gap-3">
                                    <button class="btn ${raceSettings.difficulty === 'debutant' ? 'btn-blue' : 'btn-secondary'}" 
                                            onclick="setDifficulty('debutant')">
                                        D√©butant
                                    </button>
                                    <button class="btn ${raceSettings.difficulty === 'intermediaire' ? 'btn-blue' : 'btn-secondary'}" 
                                            onclick="setDifficulty('intermediaire')">
                                        Interm√©diaire
                                    </button>
                                    <button class="btn ${raceSettings.difficulty === 'expert' ? 'btn-blue' : 'btn-secondary'}" 
                                            onclick="setDifficulty('expert')">
                                        Expert
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-lg font-bold mb-3" style="display: block;">
                                    Dur√©e: ${raceSettings.duration < 3600 ? `${raceSettings.duration / 60} min` : `${raceSettings.duration / 3600} h`}
                                </label>
                                <input type="range" min="60" max="259200" step="60" value="${raceSettings.duration}" 
                                       onchange="setDuration(this.value)" class="w-full">
                                <div class="flex justify-between text-sm mt-2">
                                    <span>1 min</span>
                                    <span>72 h</span>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-full text-xl font-bold" style="padding: 16px;" 
                                    onclick="startRace()" 
                                    ${raceState.isRacing && !championshipState.isActive ? 'disabled' : ''}>
                                ${championshipState.isActive && championshipState.currentRace <= 20 
                                    ? `Continuer Championnat (${championshipState.currentRace}/20)`
                                    : raceState.isRacing 
                                    ? 'Course en cours...' 
                                    : 'Commencer la Course'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // √âcran de course
        function renderRaceScreen() {
            const allRacers = [
                { name: "Vous", progress: raceState.progress, isPlayer: true },
                ...raceState.competitors
            ].sort((a, b) => b.progress - a.progress);
            
            return `
                <div class="container">
                    <div class="flex justify-between items-center mb-6">
                        <button class="btn btn-secondary" onclick="setScreen('menu')">
                            ‚Üê Menu Principal
                        </button>
                        <h2 class="text-2xl font-bold text-white">
                            ${championshipState.isActive ? `Championnat - Course ${championshipState.currentRace}/20` : 'Course en Direct'}
                        </h2>
                        <div style="width: 96px;"></div>
                    </div>
                    
                    <div class="card mb-6">
                        <div class="grid grid-4 gap-4 text-center mb-6">
                            <div class="stat-card stat-blue">
                                <h3 class="font-bold">Position</h3>
                                <p class="text-2xl">${raceState.position}/8</p>
                            </div>
                            <div class="stat-card stat-green">
                                <h3 class="font-bold">Temps Restant</h3>
                                <p class="text-xl font-bold">${formatTime(raceState.timeLeft)}</p>
                            </div>
                            <div class="stat-card stat-yellow">
                                <h3 class="font-bold">M√©t√©o</h3>
                                <p class="font-bold flex items-center justify-center gap-2" style="text-transform: capitalize;">
                                    <i data-lucide="wind" style="width: 20px; height: 20px;"></i>
                                    ${raceState.weatherConditions}
                                </p>
                            </div>
                            <div class="stat-card stat-purple">
                                <h3 class="font-bold">Progr√®s</h3>
                                <p class="text-xl font-bold">${Math.round(raceState.progress)}%</p>
                            </div>
                        </div>
                        
                        ${championshipState.isActive ? `
                            <div class="stat-card stat-yellow text-center mb-6">
                                <h4 class="font-bold">Points Championnat: ${championshipState.playerPoints}</h4>
                            </div>
                        ` : ''}
                        
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold">R√©glage des Voiles: ${raceState.sailTrim}%</span>
                                <span class="font-bold" style="color: ${Math.abs(50 - raceState.sailTrim) < 10 ? '#10b981' : '#dc2626'};">
                                    ${Math.abs(50 - raceState.sailTrim) < 10 ? 'OPTIMUM' : '√Ä AJUSTER'}
                                </span>
                            </div>
                            <input type="range" min="0" max="100" value="${raceState.sailTrim}" 
                                   onchange="setSailTrim(this.value)" class="w-full" 
                                   ${raceState.isAutoPilot ? 'disabled' : ''}>
                        </div>
                        
                        <div class="flex gap-4 mb-6">
                            <button class="btn ${raceState.isAutoPilot ? 'btn-primary' : 'btn-secondary'}" 
                                    onclick="toggleAutoPilot()">
                                ${raceState.isAutoPilot ? `Pilote Auto: ${gameData.autopilot.name} ON` : 'Pilote Auto: OFF'}
                            </button>
                            
                            ${raceState.isAutoPilot ? `
                                <div class="stat-card stat-green" style="font-size: 0.875rem;">
                                    Efficacit√©: ${Math.round(autopilotLevels.find(ap => ap.level === gameData.autopilot.level)?.efficiency * 100)}%
                                </div>
                            ` : ''}
                        </div>
                        
                        <!-- Visualisation de la course -->
                        <div style="background: #eff6ff; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <h3 class="font-bold mb-3 text-center">Course en Direct</h3>
                            <div class="race-track">
                                <div class="finish-line"></div>
                                <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #dc2626; font-weight: bold; font-size: 12px;">
                                    ARRIV√âE
                                </div>
                                
                                ${allRacers.map((racer, index) => {
                                    const leftPosition = Math.min((racer.progress / 100) * 90, 90);
                                    const racerStyle = racer.isPlayer ? 'color: #1e40af; background: #bfdbfe; padding: 2px 4px; border-radius: 4px;' : 'color: #374151;';
                                    const racerName = racer.isPlayer ? 'VOUS' : (championshipState.isActive ? racer.name : 'C' + (racer.id + 1));
                                    return '<div class="racer ' + (racer.isPlayer ? 'animate-bounce' : '') + '" style="left: ' + leftPosition + '%; top: ' + (8 + index * 14) + 'px;"><div class="flex items-center gap-1"><div style="font-size: 1.5rem;">' + (racer.isPlayer ? '‚õµ' : 'üö§') + '</div><span style="font-size: 12px; font-weight: bold; white-space: nowrap; ' + racerStyle + '">' + racerName + '</span></div></div>';
                                }).join('')}
                                
                                <div class="progress-indicators">
                                    <span>D√âPART</span>
                                    <span>25%</span>
                                    <span>50%</span>
                                    <span>75%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;">
                            <h3 class="font-bold mb-3">Classement</h3>
                            <div class="space-y-2">
                                ${allRacers.map((racer, index) => {
                                    const positionClass = index === 0 ? 'position-1' : index === 1 ? 'position-2' : index === 2 ? 'position-3' : 'position-other';
                                    const bgColor = racer.isPlayer ? '#bfdbfe' : 'white';
                                    const fontWeight = racer.isPlayer ? 'font-weight: bold;' : '';
                                    const racerEmoji = racer.isPlayer ? '‚õµ' : 'üö§';
                                    const racerName = racer.name || ('Concurrent ' + (racer.id + 1));
                                    return '<div class="flex justify-between items-center p-2 rounded" style="background: ' + bgColor + '; ' + fontWeight + '"><span class="flex items-center gap-2"><span class="flex items-center justify-center font-bold text-sm ' + positionClass + '" style="width: 24px; height: 24px; border-radius: 50%;">' + (index + 1) + '</span><span style="font-size: 1.125rem;">' + racerEmoji + '</span>' + racerName + '</span><span class="font-bold">' + Math.round(racer.progress) + '%</span></div>';
                                }).join('')}
                            </div>
                        </div>
                    </div>
                    
                    ${!raceState.isRacing ? (
                        championshipState.isActive && championshipState.currentRace <= 20 ? 
                        '<div class="text-center"><div class="championship-active mb-4"><h3 class="font-bold text-lg" style="color: #92400e;">Championnat en cours: ' + (championshipState.championshipData?.name || '') + '</h3><p style="color: #a16207;">Course ' + championshipState.currentRace + '/20 - Points: ' + championshipState.playerPoints + ' - Dur√©e: ' + (championshipState.raceDuration >= 3600 ? Math.floor(championshipState.raceDuration / 3600) + 'h' : Math.floor(championshipState.raceDuration / 60) + ' min') + '</p><button class="btn btn-yellow mt-4" onclick="startChampionshipRace(\'' + championshipState.level + '\', ' + JSON.stringify(championshipState.standings).replace(/"/g, '&quot;') + ', ' + championshipState.raceDuration + ')">Prochaine Course (' + (championshipState.raceDuration >= 3600 ? Math.floor(championshipState.raceDuration / 3600) + 'h' : Math.floor(championshipState.raceDuration / 60) + ' min') + ')</button></div><button class="btn btn-blue" style="padding: 12px 24px;" onclick="setScreen(\'menu\')">Retour au Menu</button></div>' :
                        '<div class="text-center"><button class="btn btn-blue" style="padding: 12px 24px;" onclick="setScreen(\'menu\')">Retour au Menu</button></div>'
                    ) : ''}
                </div>
            `;
        }
        
        // √âcran des championnats
        function renderChampionshipsScreen() {
            return `
                <div class="container">
                    ${renderRaceStatusBar()}
                    
                    <button class="btn btn-secondary mb-6" onclick="setScreen('menu')">
                        ‚Üê Retour
                    </button>
                    
                    <div class="card">
                        <h2 class="text-3xl font-bold mb-6 text-center" style="color: #92400e;">Championnats</h2>
                        
                        ${championshipState.isActive ? (
                            '<div class="championship-active"><h3 class="font-bold text-lg mb-2" style="color: #92400e;">Championnat en cours: ' + (championshipState.championshipData?.name || '') + '</h3><div class="grid grid-3 gap-4 text-center"><div class="stat-card stat-yellow"><div class="font-bold">Course Actuelle</div><div class="text-2xl font-bold">' + championshipState.currentRace + '/20</div></div><div class="stat-card stat-yellow"><div class="font-bold">Vos Points</div><div class="text-2xl font-bold">' + championshipState.playerPoints + '</div></div><div class="stat-card stat-yellow"><div class="font-bold">Position Actuelle</div><div class="text-2xl font-bold">' + ([{ name: "Vous", totalPoints: championshipState.playerPoints, isPlayer: true }, ...championshipState.standings].sort((a, b) => b.totalPoints - a.totalPoints).findIndex(s => s.isPlayer) + 1) + '</div></div></div><div class="mt-4"><h4 class="font-bold mb-2">Classement Actuel:</h4><div class="space-y-1">' + 
                            [{ name: "Vous", totalPoints: championshipState.playerPoints, isPlayer: true }, ...championshipState.standings]
                                .sort((a, b) => b.totalPoints - a.totalPoints)
                                .slice(0, 5)
                                .map((pilot, index) => '<div class="flex justify-between p-2 rounded" style="background: ' + (pilot.isPlayer ? '#bfdbfe' : '#f3f4f6') + '; ' + (pilot.isPlayer ? 'font-weight: bold;' : '') + '"><span>' + (index + 1) + '. ' + pilot.name + '</span><span>' + pilot.totalPoints + ' pts</span></div>')
                                .join('') + '</div></div></div>'
                        ) : ''}
                        
                        <div class="space-y-4">
                            ${availableChampionships.map(championship => {
                                const isUnlocked = gameData.unlockedChampionships.includes(championship.id);
                                const canUnlock = gameData.level >= championship.requirement && gameData.money >= championship.cost;
                                
                                return `
                                    <div class="championship-item">
                                        <div class="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 class="text-xl font-bold">${championship.name}</h3>
                                                <p style="color: #6b7280; text-transform: capitalize;">Niveau: ${championship.difficulty}</p>
                                                <p style="color: #6b7280;">20 courses - Dur√©e personnalisable</p>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 0.875rem; color: #6b7280;">R√©compenses Podium:</div>
                                                <div class="font-bold" style="color: #f59e0b;">ü•á ${formatNumber(championship.prize1)}‚Ç¨</div>
                                                <div class="font-bold" style="color: #9ca3af;">ü•à ${formatNumber(championship.prize2)}‚Ç¨</div>
                                                <div class="font-bold" style="color: #ea580c;">ü•â ${formatNumber(championship.prize3)}‚Ç¨</div>
                                            </div>
                                        </div>
                                        
                                        <div class="flex justify-between items-center">
                                            <div>
                                                ${championship.cost > 0 ? `
                                                    <p class="font-bold" style="color: #10b981;">Prix d'entr√©e: ${formatNumber(championship.cost)}‚Ç¨</p>
                                                ` : ''}
                                                <p style="color: #6b7280;">Niveau requis: ${championship.requirement}</p>
                                            </div>
                                            
                                            <div>
                                                ${!isUnlocked && championship.cost > 0 ? `
                                                    <button class="btn ${canUnlock ? 'btn-yellow' : 'btn-secondary'}" 
                                                            onclick="unlockChampionship('${championship.id}', ${championship.cost})"
                                                            ${!canUnlock ? 'disabled' : ''}>
                                                        ${gameData.level < championship.requirement ? 'Niveau Insuffisant' : 
                                                          gameData.money < championship.cost ? 'Argent Insuffisant' : 'D√©verrouiller'}
                                                    </button>
                                                ` : isUnlocked && !championshipState.isActive ? `
                                                    <div style="text-align: right;">
                                                        <div class="mb-2">
                                                            <label style="display: block; font-size: 0.875rem; font-weight: bold; margin-bottom: 4px;">Dur√©e par course:</label>
                                                            <select id="duration-${championship.id}" style="border: 1px solid #d1d5db; border-radius: 4px; padding: 4px 8px; font-size: 0.875rem;">
                                                                <option value="180">3 minutes</option>
                                                                <option value="300" selected>5 minutes</option>
                                                                <option value="600">10 minutes</option>
                                                                <option value="900">15 minutes</option>
                                                                <option value="1800">30 minutes</option>
                                                                <option value="3600">1 heure</option>
                                                                <option value="7200">2 heures</option>
                                                                <option value="14400">4 heures</option>
                                                                <option value="28800">8 heures</option>
                                                                <option value="43200">12 heures</option>
                                                                <option value="86400">24 heures</option>
                                                                <option value="172800">48 heures</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn btn-primary" 
                                                                onclick="startChampionshipWithDuration('${championship.id}')">
                                                            Commencer le Championnat
                                                        </button>
                                                    </div>
                                                ` : championshipState.isActive ? `
                                                    <span class="btn btn-blue" style="cursor: default;">
                                                        Championnat en Cours
                                                    </span>
                                                ` : `
                                                    <span class="btn btn-primary" style="cursor: default;">
                                                        D√©verrouill√©
                                                    </span>
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Boutique
        function renderShopScreen() {
            const upgrades = [
                { stat: 'speed', name: 'Vitesse', cost: 1000, current: gameData.boat.speed },
                { stat: 'handling', name: 'Maniabilit√©', cost: 1200, current: gameData.boat.handling },
                { stat: 'endurance', name: 'Endurance', cost: 800, current: gameData.boat.endurance }
            ];
            
            return `
                <div class="container" style="max-width: 800px;">
                    ${renderRaceStatusBar()}
                    
                    <button class="btn btn-secondary mb-6" onclick="setScreen('menu')">
                        ‚Üê Retour
                    </button>
                    
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-center">Boutique</h2>
                        <p class="text-center mb-6 text-lg">Argent disponible: ${formatNumber(gameData.money)}‚Ç¨</p>
                        
                        <div class="space-y-4">
                            ${upgrades.map(upgrade => `
                                <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;" class="flex justify-between items-center">
                                    <div>
                                        <h3 class="font-bold">${upgrade.name}</h3>
                                        <p>Niveau actuel: ${upgrade.current}</p>
                                        <p class="font-bold" style="color: #10b981;">${upgrade.cost}‚Ç¨</p>
                                    </div>
                                    <button class="btn ${gameData.money >= upgrade.cost ? 'btn-primary' : 'btn-secondary'}" 
                                            onclick="upgradeBoat('${upgrade.stat}', ${upgrade.cost})"
                                            ${gameData.money < upgrade.cost ? 'disabled' : ''}>
                                        Am√©liorer
                                    </button>
                                </div>
                            `).join('')}
                            
                            <!-- Section Pilote Automatique -->
                            <div class="upgrade-section">
                                <h3 class="text-xl font-bold mb-4" style="color: #1e40af;">ü§ñ Pilote Automatique</h3>
                                
                                <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h4 class="font-bold">Niveau Actuel: ${gameData.autopilot.name}</h4>
                                            <p style="font-size: 0.875rem; color: #6b7280;">
                                                ${autopilotLevels.find(ap => ap.level === gameData.autopilot.level)?.description}
                                            </p>
                                            <p class="font-bold" style="color: #3b82f6;">
                                                Efficacit√©: ${Math.round(autopilotLevels.find(ap => ap.level === gameData.autopilot.level)?.efficiency * 100)}%
                                            </p>
                                        </div>
                                        <div style="font-size: 1.5rem;">
                                            ${gameData.autopilot.level === 1 ? 'ü§ñ' : 
                                              gameData.autopilot.level === 2 ? 'üöÄ' :
                                              gameData.autopilot.level === 3 ? 'üéØ' : 'üß†'}
                                        </div>
                                    </div>
                                </div>
                                
                                ${gameData.autopilot.level < 4 ? `
                                    <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;" class="flex justify-between items-center">
                                        <div>
                                            <h4 class="font-bold">Prochaine Am√©lioration: ${autopilotLevels[gameData.autopilot.level]?.name}</h4>
                                            <p style="font-size: 0.875rem; color: #6b7280;">
                                                ${autopilotLevels[gameData.autopilot.level]?.description}
                                            </p>
                                            <p class="font-bold" style="color: #10b981;">
                                                ${formatNumber(autopilotLevels[gameData.autopilot.level]?.cost)}‚Ç¨
                                            </p>
                                            <p class="font-bold" style="color: #3b82f6;">
                                                Efficacit√©: ${Math.round(autopilotLevels[gameData.autopilot.level]?.efficiency * 100)}%
                                            </p>
                                        </div>
                                        <button class="btn ${gameData.money >= autopilotLevels[gameData.autopilot.level]?.cost ? 'btn-blue' : 'btn-secondary'}" 
                                                onclick="upgradeAutopilot(${autopilotLevels[gameData.autopilot.level]?.cost}, ${gameData.autopilot.level + 1})"
                                                ${gameData.money < autopilotLevels[gameData.autopilot.level]?.cost ? 'disabled' : ''}>
                                            Am√©liorer
                                        </button>
                                    </div>
                                ` : `
                                    <div style="background: linear-gradient(to right, #f59e0b, #d97706); padding: 16px; border-radius: 8px; text-align: center;">
                                        <h4 class="font-bold text-lg text-white">üèÜ NIVEAU MAXIMUM ATTEINT !</h4>
                                        <p style="color: #fef3c7;">Votre pilote automatique est au summum de la technologie</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Sponsors
        function renderSponsorsScreen() {
            return `
                <div class="container" style="max-width: 800px;">
                    ${renderRaceStatusBar()}
                    
                    <button class="btn btn-secondary mb-6" onclick="setScreen('menu')">
                        ‚Üê Retour
                    </button>
                    
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-center">Sponsors</h2>
                        
                        <div class="space-y-4">
                            ${availableSponsors.map(sponsor => {
                                const hasRequirement = gameData.level >= sponsor.requirement;
                                const hasContract = gameData.sponsors.includes(sponsor.name);
                                
                                return `
                                    <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;">
                                        <h3 class="font-bold text-lg">${sponsor.name}</h3>
                                        <p>Bonus: ${formatNumber(sponsor.bonus)}‚Ç¨</p>
                                        <p>Niveau requis: ${sponsor.requirement}</p>
                                        <div class="mt-2">
                                            ${hasContract ? `
                                                <span class="btn btn-primary" style="cursor: default;">Contrat Actif</span>
                                            ` : hasRequirement ? `
                                                <button class="btn btn-blue" onclick="signSponsor(${JSON.stringify(sponsor).replace(/"/g, '&quot;')})">
                                                    Signer le Contrat
                                                </button>
                                            ` : `
                                                <span class="btn btn-secondary" style="cursor: default;">Niveau Insuffisant</span>
                                            `}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Historique
        function renderHistoryScreen() {
            return `
                <div class="container">
                    ${renderRaceStatusBar()}
                    
                    <button class="btn btn-secondary mb-6" onclick="setScreen('menu')">
                        ‚Üê Retour
                    </button>
                    
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6 text-center">Historique des Courses</h2>
                        
                        ${gameData.raceHistory.length === 0 ? `
                            <p class="text-center" style="color: #6b7280;">Aucune course termin√©e</p>
                        ` : `
                            <div class="space-y-3">
                                ${gameData.raceHistory.slice(-10).reverse().map((race, index) => `
                                    <div style="background: #f3f4f6; padding: 16px; border-radius: 8px;" class="flex justify-between items-center">
                                        <div>
                                            <span class="font-bold">${race.date}</span>
                                            <span style="margin-left: 16px; text-transform: capitalize;">Difficult√©: ${race.difficulty}</span>
                                            <div style="font-size: 0.875rem; color: #6b7280;">${race.type || 'Course libre'}</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div class="font-bold" style="color: ${race.position === 1 ? '#f59e0b' : race.position <= 3 ? '#6b7280' : '#9ca3af'};">
                                                ${race.position === 1 ? 'ü•á' : race.position === 2 ? 'ü•à' : race.position === 3 ? 'ü•â' : `${race.position}e`}
                                            </div>
                                            <div style="font-size: 0.875rem;">
                                                <span style="color: #10b981;">+${race.prize}‚Ç¨</span>
                                                <span style="margin-left: 8px; color: #3b82f6;">+${race.xp}XP</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                        
                        ${gameData.championships.length > 0 ? `
                            <div class="mt-8">
                                <h3 class="text-xl font-bold mb-4">Historique des Championnats</h3>
                                <div class="space-y-3">
                                    ${gameData.championships.map((championship, index) => `
                                        <div style="background: #fef3c7; padding: 16px; border-radius: 8px;" class="flex justify-between items-center">
                                            <div>
                                                <span class="font-bold">${championship.name}</span>
                                                <div style="font-size: 0.875rem; color: #6b7280;">${championship.date}</div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div class="font-bold" style="color: ${championship.position === 1 ? '#f59e0b' : championship.position <= 3 ? '#6b7280' : '#9ca3af'};">
                                                    ${championship.position === 1 ? 'üèÜ' : championship.position === 2 ? 'ü•à' : championship.position === 3 ? 'ü•â' : `${championship.position}e`}
                                                </div>
                                                <div style="font-size: 0.875rem;">
                                                    <span style="color: #3b82f6;">${championship.points} pts</span>
                                                    <span style="margin-left: 8px; color: #10b981;">+${championship.prize}‚Ç¨</span>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Fonctions de contr√¥le
        function setScreen(screen) {
            currentScreen = screen;
            renderScreen();
        }
        
        function setDifficulty(difficulty) {
            raceSettings.difficulty = difficulty;
            renderScreen();
        }
        
        function setDuration(duration) {
            raceSettings.duration = parseInt(duration);
            renderScreen();
        }
        
        function setSailTrim(trim) {
            if (!raceState.isAutoPilot) {
                raceState.sailTrim = parseInt(trim);
            }
        }
        
        function toggleAutoPilot() {
            raceState.isAutoPilot = !raceState.isAutoPilot;
            renderScreen();
        }
        
        function startChampionshipWithDuration(championshipId) {
            const championship = availableChampionships.find(c => c.id === championshipId);
            const duration = parseInt(document.getElementById(`duration-${championshipId}`).value);
            startChampionship(championship, duration);
        }
        
        // Rendu principal
        function renderScreen() {
            const app = document.getElementById('app');
            
            let content = '';
            switch(currentScreen) {
                case 'menu':
                    content = renderMenuScreen();
                    break;
                case 'raceSetup':
                    content = renderRaceSetupScreen();
                    break;
                case 'race':
                    content = renderRaceScreen();
                    break;
                case 'championships':
                    content = renderChampionshipsScreen();
                    break;
                case 'shop':
                    content = renderShopScreen();
                    break;
                case 'sponsors':
                    content = renderSponsorsScreen();
                    break;
                case 'history':
                    content = renderHistoryScreen();
                    break;
                default:
                    content = renderMenuScreen();
            }
            
            app.innerHTML = content;
            
            // Initialiser les ic√¥nes Lucide
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
        });
    </script>
</body>
</html>-secondary" onclick="setScreen('race')">
                            Retour √† la Course
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Menu principal
        function renderMenuScreen() {
            return `
                <div class="container">
                    <h1 class="text-4xl text-white text-center mb-8 flex justify-center items-center gap-3">
                        <i data-lucide="anchor"></i>
                        Championnat de Voile
                    </h1>
                    
                    ${renderRaceStatusBar()}
                    
                    <div class="card">
                        <div class="grid grid-3 gap-4 text-center">
                            <div class="stat-card stat-green">
                                <h3 class="font-bold">Argent</h3>
                                <p class="text-2xl">${formatNumber(gameData.money)}‚Ç¨</p>
                            </div>
                            <div class="stat-card stat-blue">
                                <h3 class="font-bold">XP</h3>
                                <p class="text-2xl">${gameData.xp}</p>
                            </div>
                            <div class="stat-card stat-purple">
                                <h3 class="font-bold">Niveau</h3>
                                <p class="text-2xl">${gameData.level}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-5 gap-4">
                        <button class="btn btn-primary flex flex-col items-center gap-3" style="padding: 24px;" onclick="setScreen('raceSetup')">
                            <i data-lucide="play" style="width: 32px; height: 32px;"></i>
                            <span class="text-lg font-bold">Course Libre</span>
                        </button>
                        
                        <button class="btn btn-yellow flex flex-col items-center gap-3" style="padding: 24px;" onclick="setScreen('championships')">
                            <i data-lucide="trophy" style="width: 32px; height: 32px;"></i>
                            <span class="text-lg font-bold">Championnats</span>
                        </button>
                        
                        <button class="btn btn